xgboost-predictor-java
======================
[![Maven Central](https://maven-badges.herokuapp.com/maven-central/ai.h2o/xgboost-predictor/badge.svg)](https://maven-badges.herokuapp.com/maven-central/ai.h2o/xgboost-predictor)

Pure Java implementation of [XGBoost](https://github.com/dmlc/xgboost/) predictor for online prediction tasks.

## Version Upgrade
As noted in the [XGBoost Documentation for saving and loading of data](https://xgboost.readthedocs.io/en/stable/tutorials/saving_model.html)
Since XGBoost 1.0.0, XGBoost team has introduced ...
> support of using JSON for saving/loading XGBoost models and related hyper-parameters for training, 
> aiming to replace the old binary internal format with an open format that can be easily reused. 
 
The 0.3.x version of xgboost-predictor-java is based on old binary format. The JSON format introduces a breaking 
change for xgboost-predictor-java-0.3.8. The proposed version 1.0.0 has been modified to read XGBoost model in JSON format. 
Till the 0.3.x, reading of the model in binary format was closely integrated with implementation therefore
major refactoring of code was required. The current version is proposed to be 1.0.0 to reflect the 
refactoring and sync it with XGBoost 1.0.0 when the JSON format was introduced.

Library jsonschema2pojo is used to generate Java POJO objects and the POJO's are also checked in to provide 
consistent behavior with model versions. The JSON model can be read in Java POJO's using jackson databind. 
Despite major refactoring for reading model in JSON format, much of the original design is preserved for all 
calculation purposes. 

The selection of correct implementation will happen automatically as version is saved as a part of model in 
both formats. Currently for version greater than v1 only gbtree GBM is enabled. 

```java
public static GradBooster createGradBooster(String name, int majorVersion) {
        if(majorVersion >= 1){
            if ("gbtree".equals(name)) {
                return new XgbGBTree();
            }
        }else{
            if ("gbtree".equals(name)) {
                return new GBTree();
            } else if ("gblinear".equals(name)) {
                return new GBLinear();
            } else if ("dart".equals(name)) {
                return new Dart();
            }
        }
        throw new IllegalArgumentException(name + " is not supported model.");
}
```
## Summary of changes for version upgrade
1. Deleted CI and gradle specific properties, Mavenised the project by adding  pom.xml and modified gitignore

2.  Added New dependencies, Version Upgrades for Java and XGBoost model dependencies.
    
     2.1. Added dependency for logback and Jafana    
     2.2. Updated existing test to use JUnit 5    
     2.3. Added XgBoost Models for Pima Indian Diabetes Prediction for XGBoost version 0.9 and 1.4    
     2.4. Added a test to make prediction on 0.9 model    
     2.5. Added a test to make prediction on 1.4 model    
     2.6. Added jackson-databind as a dependency    

3. Refactored package structure by moving package tree to tree.reg to make space for tree.json package.

4. Added POJO's generated by jsonschema2pojo. These Pojos will be the Java object equivalent of Xgboost Json file. Successfully tested reading the model JSON in to POJO's

5.  Enabled XG-Boost Prediction with latest model
    
     5.1 Added XgbTree Implementation and JSonReader    
     5.2 Modified code to work with latest Tree Implementation    
     5.3 Added Test for Xgb Predictor with JSON verified with prediction on 1.4 model    

The project has been mavenised, for ease of use. JUnit 5 tests are introduced and model versions are saved for 
testing purpose


# Testing and Running the project

## Standard Maven life cycle.

The project can be compiled and tested via standard maven commands    
$mvn clean compile test    


It can be added as maven depndency in pom.xml by adding    

```xml
<dependencies>
  <dependency>
    <groupId>ai.h2o</groupId>
    <artifactId>xgboost-predictor</artifactId>
    <version>1.0.0-SNAPSHOT</version>
  </dependency>
</dependencies>
```

## Using Predictor
Please refer to following tests classes which demonstrate how to use this library.

1. biz.k11i.xgboost.PredictorTest: For XGBoost version less than 1.
2. biz.k11i.xgboost.XgbPredictorTest: For XGBoost version above 1.

## Next steps
1. Support other GBM after testing.
2. Incorporate Performance statistics.

The Readme for version 0.3.x can be found [here](docs/READMElt1.md).

